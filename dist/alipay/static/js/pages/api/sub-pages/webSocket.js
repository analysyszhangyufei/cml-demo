var __CML__GLOBAL=require("../../../manifest.js");__CML__GLOBAL.webpackJsonp([9],{207:function(e,t,n){n(208),n(209)},208:function(e,t){},209:function(e,t,n){function o(e){return e&&e.__esModule?e:{default:e}}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(t,"__esModule",{value:!0});var s=n(210),a=o(s),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=n(0),c=o(u);t.default={data:{title:"cml.initSocket",subtitle:"演示 websocket 链接，发送，接收和关闭",respones:[],isShowLoading:!1,msgs:{},ws:null,cell:{title:"WebSocket 演示",list:[{title:"初始化一个 socket 链接",btnText:"点击开启",extraData:{action:"open"}},{title:"发送数据",btnText:"点击发送",extraData:{action:"send"}},{title:"关闭 socket 链接",btnText:"点击关闭",extraData:{action:"close"}}]}},methods:{onBtnClicked:function(e){var t=e.detail.extraData.action;this[void 0===t?"open":t]()},showLoading:function(){this.isShowLoading=!0},hideLoading:function(){this.isShowLoading=!1},flushMsg:function(){this.msgs={},this.flatten2Responses()},flatten2Responses:function(){this.respones=Object.entries(this.msgs).map(function(e){return{name:e[0],value:"string"==typeof e[1]&&e[1],child:"object"===r(e[1])&&e[1]}})},appendMsg:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(e in this.msgs)if("string"==typeof this.msgs[e]&&(this.msgs[e]=[this.msgs[e]]),"string"==typeof t)this.msgs[e].push(t);else{var n;(n=this.msgs[e]).push.apply(n,i(t))}else this.msgs[e]=t;this.flatten2Responses()},open:function(){var e=this,t=this.ws=(0,a.default)("ws://echo.websocket.org");this.showLoading(),this.flushMsg(),this.appendMsg("建立链接","ws://echo.websocket.org"),t.onopen(function(){e.hideLoading(),e.appendMsg("建立链接","链接成功")}),t.onmessage(function(t){e.hideLoading(),e.appendMsg("接收透传信息",t.data)}),t.onerror(function(t){e.hideLoading(),e.appendMsg("链接错误",t.message)}),t.onclose(function(){e.hideLoading(),e.appendMsg("链接关闭","关闭成功"),e.ws=null})},send:function(){if(!this.ws)return this.appendMsg("错误提示","请先开启 socket 链接");this.showLoading(),this.appendMsg("发送信息",["一段文本信息: Hi, this is cml","一个数组: 1,2,3"]),this.ws.send({text:"Hi, this is cml",arr:["1","2","3"]})},close:function(){if(!this.ws)return this.appendMsg("错误提示","请先开启 socket 链接");this.ws.close()}}},t.default=c.default.createPage(t.default).getOptions()},210:function(e,t,n){function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return s.default.initSocket(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var i=n(211),s=function(e){return e&&e.__esModule?e:{default:e}}(i)},211:function(e,t,n){function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=n(212),a=function(e){return e&&e.__esModule?e:{default:e}}(s),r=n(1),u=function(){function e(){o(this,e)}return i(e,[{key:"initSocket",value:function(e){return new a.default(e)}}]),e}();t.default=new u,(0,r.copyProtoProperty)(t.default)},212:function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=function(){function e(t){return n(this,e),my.connectSocket({url:t}),this}return o(e,[{key:"onopen",value:function(e){my.onSocketOpen(function(t){e()})}},{key:"onmessage",value:function(e){my.onSocketMessage(function(t){e(t&&t.data)})}},{key:"onerror",value:function(e){my.onSocketError(function(t){e(t)})}},{key:"onclose",value:function(e){my.onSocketClose(function(t){e()})}},{key:"send",value:function(e){my.sendSocketMessage({data:e})}},{key:"close",value:function(){my.closeSocket()}}]),e}();t.default=i}},[207]);